# 要件定義書 - Kotlin Spring Boot 株価分析サイト開発
## 0. Project Root Directory
- /Kotlin_Basic/11.MultiModuleProject_LoginForm

## 1. 目的
本プロジェクトは、Kotlin Spring Bootフレームワークの機能や開発実装を学習することを目的とし、
シングルプロジェクト構造を使用した認証機能付き株価分析サイトを段階的に実装することで実践的なスキルを習得する。

## 2. 機能要件
### 2.1 必須機能
- [ ] **ユーザー認証機能**
  - ログインフォーム（ユーザー名/パスワード）
  - ユーザー登録機能
  - セッション管理
  - ログアウト機能

- [ ] **所持株式一覧と損益管理機能**
  - 所持株式データの一覧表示
    - Dataカラム:
      - 証券コード
      - 取得株価
      - 単元数
      - 現在の株価(自動更新)
      - 配当金(自動更新)
      - 優待(実質価値)
      - 配当金(配当支払いが行われた日付と一緒に保存)
      - 優待金額(優待支払いが行われた日付と一緒に保存)
      - 取得日
      - 売却日
      - 株式業種名(資産分散円グラフ作成のため)
      - 次回決算発表日(自動更新)
    - 以下のデータは画面表示のみ
      - 総配当金金額
      - 総優待金額
      - 購入金額(取得株価*単元数)
      - 資産額(現在の株価*単元数)
      - 株式損益金額
      - 利益率
      - トータル損益金額(株式損益+総配当金、総優待金)
      - 配当利回り率(取得株価に対する)
      - 配当利回り率(現在の株価に対する)
      - 優待利回り率(取得株価に対する)
      - 優待利回り率(現在の株価に対する)
      - 年間利回り率(取得株価に対する)
      - 年間利回り率(現在の株価に対する)
      - 売却日が設定されている株式の総損益金額
      - 売却日が設定されていない株式の総損益金額
      - 年間配当金
      - 年間配当利回り(年間総配当金/総購入金額)
  - 株式データの自動更新ボタン
    - 実行条件: 売却日がブランク
    - 機能: チェックボックスによる選択式(データ取得サイトへの負荷軽減のため)
  - 株式データ取得先
    - 株価: yahooファイナンス
    - 配当金: yahooファイナンス
    - 次回決算発表日: moomoo証券
  - ポートフォリオグラフ表示機能

- [ ] **データ管理機能**
  - ユーザー情報の保存
  - 所持株式データ登録・更新管理

### 2.2 オプション機能
- [ ] ポートフォリオ管理機能
- [ ] アラート機能（価格通知）
- [ ] 高度な技術分析ツール
- [ ] RESTful API の提供
- [ ] リアルタイム株価更新
- [ ] お気に入り銘柄管理機能
  - [ ] 株価上限・下限アラート
  - [ ] 開示情報更新アラート

## 3. 非機能要件
### 3.1 パフォーマンス
- ページ読み込み時間：3秒以内
- データベースクエリ実行時間：1秒以内
- 同時ユーザー数：最大100名

### 3.2 セキュリティ
- パスワードのハッシュ化（BCrypt使用）
- SQL インジェクション対策
- XSS攻撃対策
- CSRF保護の実装
- セッション管理のセキュリティ

### 3.3 保守性
- クリーンなコード構造の維持
- 適切なコメントと文書化
- テストカバレッジ70%以上
- モジュール間の疎結合設計

### 3.4 互換性
- Java 17以上対応
- Kotlin 2.2以上対応
- Spring Boot 3.5対応
- 主要ブラウザ対応（Chrome、Firefox、Safari、Edge）

## 4. 制約事項
### 4.1 技術的制約
- **開発言語**: Kotlin
- **フレームワーク**: Spring Boot 3.5
- **データベース**: H2（開発用）、MySQL（本番想定）
- **ビルドツール**: Gradle
- **テンプレートエンジン**: Thymeleaf
- **株価データAPI**: Yahoo Finance API または Alpha Vantage API (またはスクレイピング)
- **プロジェクト構造**: シングルプロジェクト

### 4.2 ビジネス制約
- 学習目的のため、商用利用は想定しない
- 開発期間：段階的実装により柔軟に対応
- リアルタイム株価データは無料APIの制限内で利用

## 5. 成功基準
### 5.1 完了の定義
- [ ] 認証機能が正常に動作する
- [ ] 株価データの取得・表示ができる
- [ ] 基本的な株価分析機能が動作する
- [ ] プロジェクト構造が適切に実装されている
- [ ] セキュリティ要件が満たされている
- [ ] 単体テストが実装されている
- [ ] README.mdに実装内容が文書化されている

### 5.2 受け入れテスト
- ユーザーがログイン・ログアウトできる
- 株価データの検索・表示ができる
- 移動平均線などの基本分析ができる
- お気に入り銘柄の登録・削除ができる
- エラーハンドリングが適切に動作する

## 6. 想定されるリスク
### 6.1 技術的リスク
- **株価API制限**: 無料APIの呼び出し制限に引っかかる可能性
  - 対策: キャッシュ機能の実装、データ取得頻度の調整

- **セキュリティ設定**: Spring Securityの設定が複雑
  - 対策: 基本的な設定から段階的に拡張

### 6.2 学習リスク
- **Kotlin文法の理解不足**: Javaとの違いによる混乱
  - 対策: 段階的な学習、豊富なコメント

## 7. 開発段階とタスク一覧
- [ ]に"実装中"は-, "実装完了"を確認すれば+を入力してください

### Phase 1: プロジェクト基盤構築 (シングルプロジェクト)
- [ ] Gradle wrapperの設置
- [ ] 基本的な依存関係の設定
- [ ] データベース設定（開発環境:H2, 本番環境MySQL）
- [ ] 基本的な設定ファイルの作成

### Phase 2: 認証機能実装
- [ ] ログイン・ログアウト機能
  - [ ] Userデータの作成(Entity, Service, Repository)
    [ ] MockUserデータの準備
    [ ] テンプレート実装
  - [ ] Controller実装
  - [ ] 認証テスト実装
  - [ ] セッション管理機能実装
  - [ ] Spring Security設定
  - [ ] セキュリティ機能動作テスト実装
- [ ] ユーザー登録・管理機能
  - [ ] ユーザー登録機能
  - [ ] ユーザー情報更新機能
  - [ ] ユーザー削除機能
  - [ ] ユーザ操作テスト実装

### Phase 3: 株価データ機能実装
- [ ] 株価データ取得API連携
- [ ] Stock エンティティの作成
- [ ] 株価データ表示画面
- [ ] 銘柄検索機能
- [ ] データキャッシュ機能

### Phase 4: 分析機能実装
- [ ] 移動平均線計算機能
- [ ] 基本的な技術指標実装
- [ ] チャート表示機能
- [ ] お気に入り銘柄管理

### Phase 5: テスト・最適化
- [ ] 単体テスト実装
- [ ] 統合テスト実装
- [ ] パフォーマンス最適化
- [ ] セキュリティテスト
- [ ] 文書化完成

## 8. 今後の検討事項

- フロントエンド技術の選択（Thymeleaf vs React/Vue.js）
- キャッシュ戦略の詳細設計
- デプロイメント戦略（Docker化等）
- モニタリング・ログ戦略
- 本番環境でのデータベース設計

## 9. 学習目標
### 9.1 Kotlin関連
- Kotlinの基本文法と慣用句
- Java互換性の理解
- データクラス、拡張関数の活用

### 9.2 Spring Boot関連
- Dependency Injection の理解
- Spring MVC パターンの実装
- Spring Data JPA の使用
- Spring Security の設定と使用
- テスト戦略（@SpringBootTest等）

### 9.3 アーキテクチャ関連
- レイヤードアーキテクチャの実装
- 疎結合設計の実践

## 10. 参考資料
- Spring Boot公式ドキュメント
- Kotlin公式ドキュメント
- Spring Security リファレンス
- 株価API ドキュメント

## 11. ディレクトリ構造
Kotlin_Basic/11.MultiModuleProject_LoginForm/: Project Root
---

**プロジェクト開始日**: 2025年7月26日  
**想定完了日**: 段階的実装により柔軟に設定  
**作成者**: [学習者名]  
**レビュー**: 各フェーズ完了時
